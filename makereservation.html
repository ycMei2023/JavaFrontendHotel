<!DOCTYPE html>
<html lang="en">
  <script>
    if(sessionStorage.getItem('userType') == 1){
    } else {
        window.location.href='index.html';
    }

</script>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script type="text/javascript"
      src="app.js">
    </script>
    <title>Java Hotel YC</title>
</head>
<body>
    <div id="nav-placeholder">
    </div>
    <br>
    <div class="container">
    <div class="row">
    <div class="col">
      <p>Samenvatting placeholder. Bevat: check-in datum, check-uit datum, aantal personen en kamertype.</p>
  
    <div class="input-group mb-3">
        <span class="input-group-text" >Forename</span>
        <input id="firstName" type="text" class="form-control" placeholder="First name" aria-label="guest's first name" aria-describedby="basic-addon1">
        <span class="input-group-text" >Surname</span>
        <input id="lastName" type="text" class="form-control" placeholder="Last Name" aria-label="guest's last name" aria-describedby="basic-addon2">
    </div>
    <!-- DO NOT REMOVE YET - instead grey-out and show pre-filled data that was grabbed from the URL
      <div class="input-group mb-3">
        <label class="input-group-text" for="amountPeople">Amount of people</label>
        <select class="form-select" id="amountPeople">
          <option selected>Select</option>
          <option value="1">One</option>
          <option value="2">Two</option>
          <option value="3">Three</option>
          <option value="4">Four</option>
          <option value="5">Five</option>
          <option value="6">Six</option>
          <option value="7">Seven</option>
          <option value="8">Eight</option>
        </select>
      </div>
      
      <div class="input-group mb-3">
        <span class="input-group-text" >Start date</span>
        <input id="beginDate" type="date" class="form-control" aria-label="guest's begin date" aria-describedby="basic-addon2">
        <span class="input-group-text" >End date</span>
        <input id="endDate" type="date" class="form-control" aria-label="guest's end date" aria-describedby="basic-addon2">
      </div>
    -->
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon2">Phone Number</span>
        <input type="number" class="form-control" placeholder="31 06 4444444" aria-label="guest's phone number" aria-describedby="basic-addon3">
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="breakfastCheck">
        <label class="form-check-label" for="breakfastCheck">
          Ontbijt toevoegen (â‚¬15 per persoon per nacht)
        </label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="businessCheck">
        <label class="form-check-label" for="businessCheck">
          Zakelijk verblijf
        </label>
      </div>
      <br>
      <button type="button" onclick="reserveR()" class="btn btn-primary"> Kamer reserveren </button>

    </div>
    </div>
    </div>

    <div id="footer-placeholder">
    </div>
  
  <!-- Modal -->
  <!-- The model currently serves no purpose. Leaving the code in, in case we need to add payment or confirmation buttons later 
          If implementing again: beware that the button no longer calls the modal! This needs to be re-created.
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Modal title</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Reservation placed for guest 
        </div>
        <div class="modal-footer">
          <button type="button" onclick="bookPayAtHotelR(reservationid)" class="btn btn-secondary" data-bs-dismiss="modal">Pay at hotel</button>
          <button type="button" onclick="bookR(reservationid)" class="btn btn-primary" data-bs-dismiss="modal">Pay now</button>
        </div>
      </div>
    </div>
  </div> -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      // NAV-bar
      $(function(){
        $("#nav-placeholder").load("navbar.html");
      });
      $(function(){
        $("#footer-placeholder").load("footer.html");
      });      

      // Collect previously passed parameters
      var urlParams = new URL(window.location).searchParams;
      var checkInDate = urlParams.get("checkInDate");
      var checkOutDate = urlParams.get("checkOutDate");
      var numGuests = urlParams.get("adults");
      var roomId = urlParams.get("roomId");

      var reservationid;
      // Type in URL ?id=... with an existing room number
      var params = new URLSearchParams(window.location.search);

        function reserveR(){
          if(checkStartIsBeforeEnd()){
            var reservationDto = {};

            // Room data
            reservationDto.amountPeople = numGuests;
            reservationDto.beginDate = checkInDate;
            reservationDto.endDate = checkOutDate;
            reservationDto.breakfast = document.getElementById("breakfastCheck").checked;
            reservationDto.business = document.getElementById("businessCheck").checked;
            reservationDto.roomId = roomId;

            // Gues data
            reservationDto.firstName = document.getElementById("firstName").value;
            reservationDto.lastName = document.getElementById("lastName").value;        
          }
          var theJSON = JSON.stringify(reservationDto);
          var xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function(){
              if(this.readyState == 4 && this.status == 200){
                  reservationid = JSON.parse(xhr.responseText);
                  xhr.open("POST", url+"/addlinkedreservation", true)
                  xhr.setRequestHeader("Content-Type","application/json");
                  xhr.send(theJSON);
                  bookingComplete(reservationId);
              }
              else{
                alert("start datum kan niet na einddatum zijn")
              }
          }
        }

        function checkStartIsBeforeEnd(){
        if(new Date(document.getElementById("beginDate").value)< new Date(document.getElementById("endDate").value)){
          return true
        }
        else{
          return false;
        }
      }
        /* Currently all reservations need manual approval by admin (in reservations CRUD). Leaving these booking-status functions in case we need them later.

        function bookR(reservationid){
            paymentStatus = true;

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if(this.readyState == 4){
                    console.log("approve succesful")
                }
            }
            xhr.open("PUT", url+"/approvereservation/"+paymentStatus, true)
            xhr.setRequestHeader("Content-Type","application/json");
            xhr.send(reservationid);
        }

        function bookPayAtHotelR(reservationid){
            paymentStatus = false;

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if(this.readyState == 4){
                    console.log("approve succesful")
                }
            }
            xhr.open("PUT", url+"/approvereservation/"+paymentStatus, true)
            xhr.setRequestHeader("Content-Type","application/json");
            xhr.send(reservationid);
        }
        */
      function bookingComplete(reservationId){
        window.location.href = "/reservationCompleted.html?reservationId="+reservationId;
      }


    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>