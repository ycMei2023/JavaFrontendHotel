<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make a reservation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
<body>
    <br>
    <div class="input-group mb-3">
        <span class="input-group-text" >Forename</span>
        <input id="firstName" type="text" class="form-control" placeholder="First name" aria-label="guest's first name" aria-describedby="basic-addon1">
        <span class="input-group-text" >Surname</span>
        <input id="lastName" type="text" class="form-control" placeholder="Last Name" aria-label="guest's last name" aria-describedby="basic-addon2">
      </div>

      <div class="input-group mb-3">
        <label class="input-group-text" for="amountPeople">Amount of people</label>
        <select class="form-select" id="amountPeople">
          <option selected>Select</option>
          <option value="1">One</option>
          <option value="2">Two</option>
          <option value="3">Three</option>
          <option value="4">Four</option>
          <option value="5">Five</option>
          <option value="6">Six</option>
          <option value="7">Seven</option>
          <option value="8">Eight</option>
        </select>
      </div>
      
      <div class="input-group mb-3">
        <span class="input-group-text" >Start date</span>
        <input id="beginDate" type="date" class="form-control" aria-label="guest's begin date" aria-describedby="basic-addon2">
        <span class="input-group-text" >End date</span>
        <input id="endDate" type="date" class="form-control" aria-label="guest's end date" aria-describedby="basic-addon2">
      </div>

      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon2">Phone Number</span>
        <input type="number" class="form-control" placeholder="31 06 4444444" aria-label="guest's phone number" aria-describedby="basic-addon3">
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="breakfastCheck">
        <label class="form-check-label" for="breakfastCheck">
          Added Breakfast +$3.50
        </label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="businessCheck">
        <label class="form-check-label" for="businessCheck">
          Business stay
        </label>
      </div>
      <br>
      <!-- Button trigger modal -->
<button type="button" onclick="reserveR()" class="btn btn-primary">
    Place reservation
  </button>
  
  <!-- Modal -->
  <!-- The model currently serves no purpose. Leaving the code in, in case we need to add payment or confirmation buttons later 
          If implementing again: beware that the button no longer calls the modal! This needs to be re-created.
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Modal title</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Reservation placed for guest 
        </div>
        <div class="modal-footer">
          <button type="button" onclick="bookPayAtHotelR(reservationid)" class="btn btn-secondary" data-bs-dismiss="modal">Pay at hotel</button>
          <button type="button" onclick="bookR(reservationid)" class="btn btn-primary" data-bs-dismiss="modal">Pay now</button>
        </div>
      </div>
    </div>
  </div> -->
    <script>
      var reservationid
        function reserveR(){
            var reservationDto = {};
            reservationDto.amountPeople = document.getElementById("amountPeople").value;
            reservationDto.beginDate = document.getElementById("beginDate").value;
            reservationDto.endDate = document.getElementById("endDate").value;
            reservationDto.breakfast = document.getElementById("breakfastCheck").checked;
            reservationDto.business = document.getElementById("businessCheck").checked;

            var guest = {};
            reservationDto.firstName = document.getElementById("firstName").value;
            reservationDto.lastName = document.getElementById("lastName").value;

            var theJSON = JSON.stringify(reservationDto);
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if(this.readyState == 4){
                    console.log("reservation with guest linked succesfully");
                    reservationid = JSON.parse(xhr.responseText);
                    console.log(reservationid);
                }
            }

            xhr.open("POST", "http://localhost:8080/addlinkedreservation", true)
            xhr.setRequestHeader("Content-Type","application/json");
            xhr.send(theJSON);
        }
        /* Currently all reservations need manual approval by admin (in reservations CRUD). Leaving these booking-status functions in case we need them later.

        function bookR(reservationid){
            paymentStatus = true;

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if(this.readyState == 4){
                    console.log("approve succesful")
                }
            }
            xhr.open("PUT", "http://localhost:8080/approvereservation/"+paymentStatus, true)
            xhr.setRequestHeader("Content-Type","application/json");
            xhr.send(reservationid);
        }

        function bookPayAtHotelR(reservationid){
            paymentStatus = false;

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if(this.readyState == 4){
                    console.log("approve succesful")
                }
            }
            xhr.open("PUT", "http://localhost:8080/approvereservation/"+paymentStatus, true)
            xhr.setRequestHeader("Content-Type","application/json");
            xhr.send(reservationid);
        }
        */

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>