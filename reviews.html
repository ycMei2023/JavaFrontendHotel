<!DOCTYPE html>
<html lang="en">
    <script>
        if(sessionStorage.getItem('userType') == 1){
        } else {
            window.location.href='index.html';
        }
    
    </script>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script type="text/javascript"
        src="app.js">
    </script>
    <title>Document</title>
</head>
<body>
    
    <!-- NAVBAR -->
    <div id="nav-placeholder"></div>
    
    <!-- Page content -->
    <div class="container">
        <section>
            <h1>Achtergelaten Beoordelingen</h1>
            <br>
            <label for="reviewName">Naam</label>
            <input id="reviewName">
            <br>
            <label for="reviewText">Bericht</label>
            <input id="reviewText">
            <br>
            <label for="number">Score (1-5)</label>
            <input type="number" id="reviewScore">
            <br>
            <button onclick="addreview()">Beoordeling toevoegen</button>
            <button onclick="showAllreviews()">Alle beoordelingen</button>
        </section>
    </div>
    <div class="container">
        <section>
            <div id="allReviews"></div>
        </section>
    </div>

    <!-- FOOTER -->
    <div id="footer-placeholder"></div>

</body>


</html>



<script type="text/javascript">

    $(function () {
        $("#nav-placeholder").load("navbar.html");
    });
    $(function () {
        $("#footer-placeholder").load("footer.html");
    });

function showAllreviews(){
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function(){
        if(this.readyState == 4){
            var allreviews = JSON.parse(this.responseText);
            var finalstring = '<table class="table table-striped table-sm" border=1>'
            for(var x = 0; x < allreviews.length; x++){
                finalstring += `<tr>
                    <td>${allreviews[x].name}</td>
                    <td>${allreviews[x].rating}</td>
                    <td>${allreviews[x].reviewText}</td>
                    <td>${allreviews[x].approved}</td>
                    <td><button onclick=updateReview(${allreviews[x].id})>edit</button></td>
                    <td><button onclick=deleteReview(${allreviews[x].id})>delete</button></td> 
                    <td><button onclick=toggleApproval(${allreviews[x].id})>approval</button></td>
                    </tr>`
                    
            }
        finalstring += "</table>"
        document.getElementById('allReviews').innerHTML = finalstring;
        }
    }
    xhr.open("GET",url+"/Reviews", true);
    xhr.send();
}

 function addreview() {
    var theReview = {}
    theReview.rating = document.getElementById("reviewScore").value;
    theReview.name = document.getElementById("reviewName").value;
    theReview.reviewText = document.getElementById("reviewText").value;
    var theJSON = JSON.stringify(theReview);
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function(){
        if(this.readyState == 4){
            console.log("Review added");
            showAllreviews();
        }
    }

    xhr.open("POST",url+"/AddReview", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.send(theJSON);
 }

 function deleteReview(id){
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function(){
        if(this.readyState == 4){
            console.log("Review deleted");
            showAllreviews();
        }
    }
    xhr.open("DELETE",url+"/DeleteReview/"+id, true);
    xhr.send();
 }

 function updateReview(id){
    var theReview = {}
    theReview.id = id;
    theReview.rating = document.getElementById("reviewScore").value;
    theReview.name = document.getElementById("reviewName").value;
    theReview.reviewText = document.getElementById("reviewText").value;
    var theJSON = JSON.stringify(theReview);
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function(){
        if(this.readyState == 4){
            console.log("Review updated");
            showAllreviews();
        }
    }
    
    xhr.open("PUT",url+"/UpdateReview", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.send(theJSON);
 }

function toggleApproval(id){
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function(){
        if(this.readyState == 4){
            console.log("Review approved");
            showAllreviews();
        }
    }
    xhr.open("PUT",url+"/ApproveReview", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.send(id);
}

showAllreviews();

</script>